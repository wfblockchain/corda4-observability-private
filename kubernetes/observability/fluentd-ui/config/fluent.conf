<source>
  # http://docs.fluentd.org/articles/in_forward
  @type forward
  port 24224
</source>

<source>
  # http://docs.fluentd.org/articles/in_http
  @type http
  port 9880
</source>

<source>
  @type monitor_agent
  port 24220
</source>
<source>
  @type debug_agent
  port 24230
</source>

<match debug.*>
  # http://docs.fluentd.org/articles/out_stdout
  @type stdout
</match>

<source>
  @type tail
  path /var/log/input/partya.log
  tag corda
  pos_file /tmp/fluentd--B651162926.pos
  ####
  # This parser works if there is no multiple lines for example
  # 2022-04-28T22:26:38+00:00	corda	{"level":"INFO ","timestamp":"2022-04-28T01:47:32,772Z","class":"flow ?.@","process_id":"72","thread_id":"185","thread_name":"flow-worker","actor_id":"","actor_owning_identity":" C=GB, tx_id=D64C9A54936C49C202D8C7E6BC08F401B4ED8E61340EA7F5328B39637B721669","computer_name":"partya-56975cbc46-p8bk7","msg":"All parties received the transaction successfully."}
  ###
  <parse>
    @type regexp
    expression /^\[(?<level>\w* )\] (?<timestamp>\S*)\ (?<class>\S*\s*\S*)  \[ProcessID:(?<process_id>\d*) ThreadID:(?<thread_id>\d*) ThreadName:(?<thread_name>\S*) {(actor_id=)?(?<actor_id>[a-zA-Z]*?)(, actor_owning_identity=)?(?<actor_owning_identity>\S* \S* \S*)*?(, tx_id=)?(?<tx_id>[0-9a-zA-Z]*)*?} ComputerName:(?<computer_name>[0-9a-zA-Z\-]*)\] \|(?<msg>[\s\S]*)\|/im
  </parse>  
  # <parse>
  #   @type regexp
  #   expression /^\[(?<level>\w* )\] (?<timestamp>\S*)\ (?<class>\S*\s*\S*)  \[ProcessID:(?<process_id>\d*) ThreadID:(?<thread_id>\d*) ThreadName:(?<thread_name>\S*) {(actor_id=)?(?<actor_id>[a-zA-Z]*?)(, actor_owning_identity=)?(?<actor_owning_identity>\S* \S* \S*)*?(, tx_id=)?(?<tx_id>[0-9a-zA-Z]*)*?} ComputerName:(?<computer_name>[0-9a-zA-Z\-]*)\] \|(?<msg>[0-9a-zA-Z\-_ :\'\"\\\r\n\{\}\t\*\@\.\[\]\=\,\(\)/]*)\|/im
  # </parse>
  # <parse>
  #   @type multiline
  #   format_firstline /^Started/
  #   format1 /Started (?<method>[^ ]+) [\s\S]*/
  # </parse>
  ####
  # This parse process multiline but produces not the correct results
  # 2022-04-28T22:18:06+00:00	corda	{"msg":"[INFO ] 2022-04-28T01:47:26,724Z FlowShellCommand ?.@  [ProcessID:72 ThreadID:172 ThreadName:pool-13-thread-1 {} ComputerName:partya-56975cbc46-p8bk7] |Executing command \"flow start CashIssueAndPaymentFlow amount: 1002 GBP, issueRef: TestTransaction, recipient: PartyB, anonymous: false, notary: Notary\",|"}
  ### 
  #<parse>
  #  @type multiline
  #  format_firstline  /^\[(?<level>\w* )\] /
  #  format1 /(?<timestamp>\S*)\ (?<class>\S*\s*\S*)  \[ProcessID:(?<process_id>\d*) ThreadID:(?<thread_id>\d*) ThreadName:(?<thread_name>\S*) {(actor_id=)?(?<actor_id>[a-zA-Z]*?)(, actor_owning_identity=)?(?<actor_owning_identity>\S* \S* \S*)*?(, tx_id=)?(?<tx_id>[0-9a-zA-Z]*)*?} ComputerName:(?<computer_name>[0-9a-zA-Z\-]*)\] |(?<msg>[\s\S]*)|/
  #</parse>
</source>

#<match **>
#  @type stdout
#</match>

<match **>
  @type file
  path /var/log/output
  <buffer>
  	timekey_wait 5m
    timekey 86400
    timekey_use_utc true
    path /var/log/output/logs.*    
  </buffer>
  append true
</match>